/*! SCIA 2014-04-17 */
!function(a){var b={},d=b;b.head=document.getElementsByTagName("head")[0],b.core={init:function(){Stripe.setPublishableKey("pk_test_HvH0HNcaXzQcAPN8wruR6JXU");var a=d.utils.parseQueryString();if("recover"==a.action){var b=a.id,c=a.token;d.Sidebar.reset_password.display(b,c)}else"verified"==a.action&&d.Flash("Thanks for verifying your account!")}},b.logout=function(){console.log("did?"),$.post("/d1/user/logout",function(c){0===c.status?a.location=a.location.origin+a.location.pathname:b.Flash(c.short_message)})},b.Flash=function(a){var c=b.utils.getWindowSize(),d="<div id='scia-flash-message'>"+a+"</div>";$("body").append(d);var e=$("#scia-flash-message");e.css({display:"inline-block"});var f=e.width(),g=(c.width-f)/2;e.css({position:"absolute",top:"35px",left:g,"padding-left":"50px","padding-right":"50px","text-align":"center",background:"red","line-height":"25px","font-size":"14px"}),setTimeout(function(){e.remove()},5e3)},b.Sidebar={$sidebar:null,$sidebarLoading:null,$wrapper:null,windowDimensions:null,isVisible:!1,_transactionInFlight:!1,loadingImgAsset:"",init:function(a,c,d){var e=this;e.windowDimensions=b.utils.getWindowSize();var f=e.windowDimensions;if(""!==a&&null!==a&&""!==c&&null!==c&&""!==d&&null!==d){e.$wrapper=$("#"+a);{e.$wrapper}e.$sidebar=$("#"+c);var g=e.$sidebar;e.loadingImgAsset=d,g.css("height",f.height),g.on("click","#sidebar-close",function(){e._hide()}),$(document).keyup(function(a){27==a.keyCode&&e._hide()})}},_expose:function(a){var c=this,d=-(.2*c.windowDimensions.width),e=(.2*c.windowDimensions.width,$("#sidebar-mainWrapper").height()),f=(c.windowDimensions.height-e)/3;$("#sidebar-mainWrapper").css({top:f}),c.isVisible&&a&&a(),c.$wrapper.animate({left:d},350,function(){}),c.$sidebar.animate({right:0},350,function(){c.isVisible=!0,a&&a()}),b.utils.disable_scroll()},_hide:function(a){var c=this;c.isVisible||a&&a(),c.$wrapper.animate({left:0},350,function(){}),c.$sidebar.animate({right:-400},350,function(){c.isVisible=!1,a&&a()}),b.utils.enable_scroll()},_renderBase:function(){var a=this,b=a.$sidebar,c=a.loadingImgAsset,d="";return d+="<div id='sidebar-close'></div>",d+="<div id='sidebar-loading-wrapper'>",d+="<img id='sidebar-loading-icon' src='"+c+"' width='50' height='50'/>",d+="</div>",d+="<div id='sidebar-mainWrapper'></div>",b.empty().html(d),$("#sidebar-mainWrapper")},_beginTransaction:function(){var a=this;return a._transactionInFlight?!1:(a._transactionInFlight=!0,$("#sidebar-loading-wrapper").show().animate({opacity:1},300,function(){}),!0)},_endTransaction:function(){var a=this;a._transactionInFlight=!1,$("#sidebar-loading-wrapper").hide(),$("#sidebar-loading-wrapper").css({opacity:0})}},b.Sidebar.forgot_password={display:function(){this._render(),b.Sidebar._expose()},_render:function(){var a="",c=b.Sidebar._renderBase();a+="<div>",a+="<div id='sidebar-fgPwd-error' class='sidebar-error'></div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label' for='LoginEmail'>Registered Email</label>",a+="<input id='sidebar-fgPwd-email' class='sidebar-input' type='email' name='LoginEmail' tabindex='1' />",a+="</div>",a+="<div class='sidebar-button large-button' onclick='SCIA.Sidebar.forgot_password.submit(this)'>Send Email</div>",a+="</div>",c.html(a)},_renderSuccess:function(){var a="",c=b.Sidebar._renderBase();a+="<div class='sidebar-error'>Awesome, you're almost there!<br/>Check your email for further instructions</div>",c.html(a),b.Sidebar._expose()},submit:function(){var c=this,d=$("#sidebar-fgPwd-email").val(),e=a.location.origin+a.location.pathname,f="/d1/user/recover?email="+d+"&cb="+e;b.Sidebar._beginTransaction()&&$.get(f,function(a){b.Sidebar._endTransaction(),0===a.status?c._renderSuccess():10402==a.status&&$("#sidebar-fgPwd-error").empty().html("This email isn't registered")})}},b.Sidebar.login={display:function(){this._render(),b.Sidebar._expose()},_render:function(){var a="",c=b.Sidebar._renderBase();a+="<div>",a+="<div id='sidebar-login-error' class='sidebar-error'></div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label' for='LoginEmail'>Email</label>",a+="<input id='sidebar-loginEmail' class='sidebar-input' type='email' name='LoginEmail' value='' tabindex='1' />",a+="</div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label' for='LoginPassword'>Password</label>",a+="<input id='sidebar-loginPassword' class='sidebar-input' type='password' name='LoginPassword' value='' tabindex='2' />",a+="</div>",a+="<div class='sidebar-button large-button' onclick='SCIA.Sidebar.login.submit(this)'>login</div>",a+="<a class='sidebar-ui-link' href='javascript:SC.Sidebar.forgot_password.display()'>Forgot Password?</a>",a+="</div>",c.html(a)},submit:function(){var c=$("#sidebar-loginEmail").val(),d=$("#sidebar-loginPassword").val();b.Sidebar._beginTransaction()&&$.post("/d1/user/login",{email:c,pwd:d},function(d){b.Sidebar._endTransaction(),0===d.status?b.Sidebar._hide(function(){a.location=a.location.origin+a.location.pathname}):10402==d.status?$("#sidebar-login-error").empty().html("This email isn't registered"):10050==d.status?$("#sidebar-login-error").empty().html("Invalid password"):10051==d.status&&$("#sidebar-login-error").empty().html("This account hasn't been verified<br/><a class='sidebar-ui-link' href=\"javascript:SC.Sidebar.resend_verification_email._submit('"+c+"')\">Resend verification email?</a>")})}},b.Sidebar.purchase_membership={membershipPrice:-1,display:function(){this._pre_process(),b.Sidebar._expose()},_pre_process:function(){var a=this;return email=decodeURIComponent(b.utils.readCookie("email")),null===email?void b.logout():-1==email.toLowerCase().indexOf("@usc.edu")?void b.Flash("Drats, you have to have an @usc.edu email<br/>to buy membership."):void(b.Sidebar._beginTransaction()&&$.get("/d1/membership",function(c){b.Sidebar._endTransaction(),0!==c.status&&(b.Flash("Bugger, looks like something is broken.<br/>Try again later"),b.Sidebar._hide()),a.membershipPrice=c.data.price,a._render(),b.Sidebar._expose()}))},_render:function(){var a=this,c="",d=b.Sidebar._renderBase(),e=(1.029*parseInt(a.membershipPrice,10)+.3).toFixed(2);c+="<div>",c+="<div id='sidebar-buyM-error' class='sidebar-error'>Current Membership Price: $"+e+"</div>",c+="<div class='sidebar-input-wrapper'>",c+="<label class='sidebar-label'>Name on card</label>",c+="<input id='sidebar-buyM-nameOnCard' class='sidebar-input' type='text' tabindex='1' />",c+="</div>",c+="<div class='sidebar-input-wrapper'>",c+="<label class='sidebar-label'>Card number</label>",c+="<div>",c+="<input id='sidebar-buyM-cSection1' class='sidebar-input sidebar-card' type='text' maxlength='4' tabindex='2' />",c+="<input id='sidebar-buyM-cSection2' class='sidebar-input sidebar-card' type='text' maxlength='4' tabindex='3' />",c+="<input id='sidebar-buyM-cSection3' class='sidebar-input sidebar-card' type='text' maxlength='4' tabindex='4' />",c+="<input id='sidebar-buyM-cSection4' class='sidebar-input sidebar-card' type='text' maxlength='4' tabindex='5' />",c+="<div class='clear'></div>",c+="</div>",c+="</div>",c+="<div>",c+="<div class='sidebar-input-wrapper sidebar-input-expcvc'>",c+="<label class='sidebar-label'>EXP <span class='sidebar-label-smaller'>(MM/YY)</span></label>",c+="<input id='sidebar-buyM-exp' class='sidebar-input' type='text' tabindex='6' />",c+="</div>",c+="<div class='sidebar-input-wrapper sidebar-input-expcvc'>",c+="<label class='sidebar-label'>CVC</label>",c+="<input id='sidebar-buyM-cvc' class='sidebar-input' tabindex='7' />",c+="</div>",c+="<div class='clear'></div>",c+="</div>",c+="<label class='sidebar-label'>Remember this card </label><input id='sidebar-buyM-rememberCard' type='checkbox'/>",c+="<div class='sidebar-button large-button' onclick='SCIA.Sidebar.purchase_membership.submit(this)'>Buy Membership</div>",c+="</div>",d.html(c)},_renderSuccess:function(){var a="",c=b.Sidebar._renderBase();a+="<div class='sidebar-error'>Welcome to the SCIA family!<br/>We'll be sending you an email shortly with your receipt.</div>",c.html(a),b.Sidebar._expose()},submit:function(){var a=this,c=$("#sidebar-buyM-nameOnCard").val(),d=$("#sidebar-buyM-cSection1").val(),e=$("#sidebar-buyM-cSection2").val(),f=$("#sidebar-buyM-cSection3").val(),g=$("#sidebar-buyM-cSection4").val(),h=d+""+e+f+g,i=$("#sidebar-buyM-exp").val().split("/"),j=$("#sidebar-buyM-cvc").val(),k=$("#sidebar-buyM-rememberCard").is(":checked");b.Sidebar._beginTransaction()&&Stripe.card.createToken({name:c,number:h,cvc:j,exp_month:i[0],exp_year:i[1]},function(c,d){if(d.error)return b.Sidebar._endTransaction(),void $("#sidebar-buyM-error").empty().html(d.error.message);var e=d.id,f="/d1/user/"+b.utils.readCookie("id")+"/buyMembership";$.post(f,{stripeToken:e,saveCard:k,amountAuthorized:a.membershipPrice},function(c){return b.Sidebar._endTransaction(),0===c.status?void a._renderSuccess():(console.log("?"),void $("#sidebar-buyM-error").empty().html(d.short_message))})})}},b.Sidebar.register={display:function(){this._render(),b.Sidebar._expose()},_render:function(){var a="",c=b.Sidebar._renderBase();a+="<div>",a+="<div id='sidebar-register-error' class='sidebar-error'></div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>First Name</label>",a+="<input id='sidebar-register-fname' class='sidebar-input' type='text' tabindex='1' />",a+="</div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>Last Name</label>",a+="<input id='sidebar-register-lname' class='sidebar-input' type='text' tabindex='2' />",a+="</div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>Email <span class='sidebar-label-smaller'>(@usc.edu required for membership)</span></label>",a+="<input id='sidebar-register-email' class='sidebar-input' type='email' tabindex='3' />",a+="</div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>Password</label>",a+="<input id='sidebar-register-password' class='sidebar-input' type='password' tabindex='4' />",a+="</div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>Confirm Password</label>",a+="<input id='sidebar-register-password-conf' class='sidebar-input' type='password' tabindex='5' />",a+="</div>",a+="<div class='sidebar-button large-button' onclick='SCIA.Sidebar.register.submit(this)'>Register</div>",a+="</div>",c.html(a)},_renderSuccess:function(){var a="",c=b.Sidebar._renderBase();a+="<div class='sidebar-error'>Awesome, you're almost there!<br/>Check your email for further instructions</div>",c.html(a),b.Sidebar._expose()},submit:function(){var c=this,d=$("#sidebar-register-fname").val(),e=$("#sidebar-register-lname").val(),f=$("#sidebar-register-email").val(),g=$("#sidebar-register-password").val(),h=$("#sidebar-register-password-conf").val();if(b.Sidebar._beginTransaction())return""===d||""===e||""===f||""===g||""===h?void $("#sidebar-register-error").empty().html("All fields are required"):-1==f.indexOf("@")?void $("#sidebar-register-error").empty().html("Invalid email"):g!=h?void $("#sidebar-register-error").empty().html("passwords don't match"):void $.post("/d1/user/create",{f_name:d,l_name:e,email:f,pwd:g,cb:a.location.origin+a.location.pathname},function(a){return b.Sidebar._endTransaction(),0===a.status?void c._renderSuccess():10001==a.status?void $("#sidebar-register-error").empty().html("This email is already registered.<br/><a class='sidebar-ui-link' href='javascript:SC.Sidebar.forgot_password.display()'>Forgot Password?</a>"):10501==a.status?void $("#sidebar-register-error").empty().html("UhOh, we messed something up.<br/>Try again later."):void $("#sidebar-register-error").empty().html(a.short_message)})}},b.Sidebar.resend_verification_email={_submit:function(c){var d=this;b.Sidebar._beginTransaction()&&$.post("/d1/user/resendVerificationEmail",{email:c,cb:a.location.origin+a.location.pathname},function(a){return b.Sidebar._endTransaction(),0===a.status?void d._render("Awesome, you're almost there!<br/>Check your email for further instructions"):void d._render(a.short_message)})},_render:function(a){var c="",d=b.Sidebar._renderBase();c+="<div class='sidebar-error'>"+a+"</div>",d.html(c),b.Sidebar._expose()}},b.reset_password={id:"",token:"",display:function(a,c){this.id=a,this.token=c,this._render(),b.Sidebar._expose()},_render:function(){var a="",c=b.Sidebar._renderBase();a+="<div id='sidebar-reset-pwd'>",a+="<div id='sidebar-rstPwd-error' class='sidebar-error'></div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>New Password</label>",a+="<input id='sidebar-new-password' class='sidebar-input' type='password' tabindex='1' />",a+="</div>",a+="<div class='sidebar-input-wrapper'>",a+="<label class='sidebar-label'>Confirm Password</label>",a+="<input id='sidebar-new-password-conf' class='sidebar-input' type='password' tabindex='2' />",a+="</div>",a+="<div class='sidebar-button large-button' onclick='SCIA.Sidebar.reset_password.submit(this)'>Reset Password</div>",a+="</div>",c.html(a)},_renderSuccess:function(){var a="",c=b.Sidebar._renderBase();a+="<div class='sidebar-error'>Your password has been reset :-)</div>",c.html(a),b.Sidebar._expose()},submit:function(){var a=this,c=$("#sidebar-new-password").val(),d=$("#sidebar-new-password-conf").val(),e=a.id,f=a.token;if(b.Sidebar._beginTransaction())return""===c?void $("#sidebar-rstPwd-error").empty().html("Invalid password"):c!=d?void $("#sidebar-rstPwd-error").empty().html("The passwords don't match"):void $.post("/d1/user/reset",{id:e,token:f,new_pwd:c},function(c){b.Sidebar._endTransaction(),0===c.status?a._renderSuccess():$("#sidebar-rstPwd-error").empty().html(c.short_message)})}},b.ZuneView={zuneCards:[],init:function(a,b){function d(a){return String.fromCharCode(a.charCodeAt(0)+1)}function e(a,b,c){var d=document.createElement("div"),e=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),j=document.createElement("img"),k=document.createElement("img"),l=a*i.width;d.className="flip-container",d.style.width=l,d.style.height=l,d.style.top=c,d.style.left=b,e.className="flipper",g.className="front",h.className="back",j.className="imgFront zuneImg",j.width=l-5,j.height=l-5,j.src=f.getRandomImg(),k.className="imgBack zuneImg",k.width=l-5,k.height=l-5,k.src=f.getRandomImg(),g.appendChild(j),h.appendChild(k),e.appendChild(g),e.appendChild(h),d.appendChild(e);var m=new f.ZuneCard(d,j,k);return f.zuneCards.push(m),d}var f=this,g=document.getElementById(b),h={width:g.clientWidth,height:g.clientHeight},i={width:h.height/a.height,height:h.height/a.height},j="A",k=0,l=0,m=null;a.width=Math.floor(h.width/i.width);var n=0,o=new Array(a.width);for(c=0;c<a.width;c++)o[c]=new Array(a.height);var p=!0;for(document.getElementById("wrapper").style.width=a.width*i.width+"px",r=0;r<a.height;r++)for(c=0;c<a.width;c++)if(void 0===o[c][r]){var q=Math.floor(4*Math.random())+2,s=c,t=r,u=0;for(p&&(q=2);q>u&&s<a.width&&void 0===o[s][r]&&t<a.height;)u++,s++,t++;for(s=c;c+u>s;s++)for(t=r;r+u>t;t++)o[s][t]=j;if(k=c*i.width+n,l=r*i.height,m=new e(u,k,l),p){var v=f.zuneCards[0];v.imgFront.src="../assets/images/logo.png",v.imgBack.src="../assets/images/logo.png",f.zuneCards=[],p=!1}g.appendChild(m),j=d(j)}setInterval(function(){f.updateZuneImgs()},5e3)},getRandomImg:function(){var a=Math.floor(47*Math.random());return"../assets/images/"+a+".jpg"},updateZuneImgs:function(){var a=Math.floor(Math.random()*this.zuneCards.length),b=this.zuneCards[a],c=this;b.frontVisible?b.imgBack.src=c.getRandomImg():b.imgFront.src=c.getRandomImg(),b.frontVisible=!b.frontVisible,b.flipContainer.classList.toggle("flip")},ZuneCard:function(a,b,c){return{flipContainer:a,imgFront:b,imgBack:c,frontVisible:!0}}},b.navigation={init:function(){if(null!==b.utils.readCookie("id")){var c=b.utils.readCookie("f_name")+" "+b.utils.readCookie("l_name"),d=decodeURIComponent(b.utils.readCookie("email"));$("#nav-personal > span").html(c),$("#nav-register").remove(),$("#nav-login").remove(),-1==d.toLowerCase().indexOf("@usc.edu")&&$("#nav-buy-membership").remove(),b.utils.readCookie("is_member")&&$("#nav-buy-membership").remove()}else $("#nav-personal").remove();switch($("#navigation").animate({opacity:1},100,function(){}),a.location.pathname){case"/about/":$("#nav-about").css("color","rgb(204,40,40)");break;case"/events/":$("#nav-events").css("color","rgb(204,40,40)")}}},b.utils={keys:[37,38,39,40],preventDefault:function(b){b=b||a.event,b.preventDefault&&b.preventDefault(),b.returnValue=!1},keydown:function(a){for(var c=b.utils,d=c.keys,e=d.length;e--;)if(a.keyCode===d[e])return void c.preventDefault(a)},wheel:function(a){var c=b.utils;c.preventDefault(a)},disable_scroll:function(){var c=(b.utils,this.wheel),d=this.keydown;a.addEventListener&&a.addEventListener("DOMMouseScroll",c,!1),a.onmousewheel=document.onmousewheel=c,document.onkeydown=d},enable_scroll:function(){var c=(b.utils,this.wheel);a.removeEventListener&&a.removeEventListener("DOMMouseScroll",c,!1),a.onmousewheel=document.onmousewheel=document.onkeydown=null},getWindowSize:function(){return{width:a.innerWidth,height:a.innerHeight}},getGCD:function(a,b){for(var c=-1,d=0,e=0;0!==c;)d=a>b?a:b,e=a>b?b:a,c=d%e,a>b?a=c:b=c;return e},parseURL:function(a){var b=document.createElement("a");return b.href=a,b},parseQueryString:function(){for(var b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f=a.location.search.substring(1),g={},h=0;30>h&&(b=d.exec(f),null!==b);)g[e(b[1])]=e(b[2]),h++;return g},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}},"object"==typeof a&&(a.SCIA=a.SC=b)}(window);